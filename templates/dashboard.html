<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}" />
</head>
<body>

  <nav class="navbar">
  <div class="nav-logo">
    Localate <img src="{{ url_for('static', filename='cat_logo.svg') }}" alt="Localate Logo" class="nav-icon">
  </div>
  <input type="checkbox" id="nav-toggle" class="nav-toggle">
  <ul class="nav-links">
    <li><a href="{{ url_for('business.index') }}"><img src="{{ url_for('static', filename='home_logo.svg') }}" alt="Home Icon" class="nav-icon-small"> Home</a></li>
      <li><a href="{{ url_for('business.dashboard') }}"><img src="{{ url_for('static', filename = 'dash_svg.svg') }}" alt ="Dash Icon" name="dash-icon" class="nav-icon-small"> Dashboard</a></li>
    <li><a href="{{ url_for('auth.logout') }}"><img src="{{ url_for('static', filename = 'logout.svg') }}" alt ="Logout Icon" name="logout-icon" class="nav-icon-small"> Logout</a></li>
  </ul>
  <label for="nav-toggle" class="nav-toggle-label">
    <span></span>
  </label>
</nav>

  <main class="dashboard-content">

<main class="dashboard-content">
  <section class="dashboard-card">
    <div class="profile-section">
      <form method="POST" action="{{ url_for('user.upload_profile_pic') }}" enctype="multipart/form-data" id="profilePicForm">
        <label for="profilePicInput" class="profile-circle" aria-label="Upload Profile Picture">
          {% if current_user.profile_image_url %}
            <img src="{{ current_user.profile_image_url }}" alt="Your Profile" />
          {% else %}
            <span class="plus-only">+</span>
          {% endif %}
        </label>
        <input type="file" id="profilePicInput" name="profile_pic" accept="image/*" style="display: none;" onchange="document.getElementById('profilePicForm').submit()" />
      </form>

      <div class="edit-profile-btn-container">
        <a href="{{ url_for('user.edit_profile') }}" class="edit-profile-btn">Manage Profile</a>
      </div>
    </div>

    <div class="action-buttons">
      <a href="{{ url_for('business.create_business') }}" class="action-btn">+ Create Your Business</a>
      <a href="{{ url_for('search.search') }}" class="action-btn">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20" style="vertical-align: middle; margin-right: 4px;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35m0 0a7.5 7.5 0 1 0-10.6-10.6 7.5 7.5 0 0 0 10.6 10.6z"/>
        </svg>
        Search Local Businesses
      </a>
    </div>
  </section>
</main>

    <div class="main-boxes-container">

      <section class="business-section">
      <h2>Your Appointments</h2>
      <div class="business-list">
        {% if appointments %}
          {% for appt in appointments %}
            <div class="business-card">
              <h3>{{ appt.business.name or "Unknown Business" }}</h3>
              <p>{{ appt.business.category or "Unknown Category" }}</p>

              {% set formatted_time = appt.time[:5] %}
              {% set hour = formatted_time.split(':')[0]|int %}
              {% set minute = formatted_time.split(':')[1] %}
              {% set ampm = 'AM' if hour < 12 else 'PM' %}
              {% set display_hour = hour if hour <= 12 else hour - 12 %}
              <p>Appointment: {{ appt.date }} at {{ '%02d' % display_hour }}:{{ minute }} {{ ampm }}</p>

              <p>Status: 
                {% if appt.confirmed %}
                  <span style="color: #4caf50; font-weight: bold;">Confirmed</span>
                {% else %}
                  <span style="color: #f44336; font-weight: bold;">Pending</span>
                {% endif %}
              </p>
            </div>
          {% endfor %}
        {% else %}
          <p>No appointments found.</p>
        {% endif %}
      </div>
    </section>

      <section class="your-business-section">
        <h2>Your Businesses</h2>
        <div class="your-business-list">
          {% if businesses %}
            {% for biz in businesses %}
              <div class="business-card owner">
                <h3>{{ biz.name }}</h3>
                <p>Category: {{ biz.category }}</p>
                <p>Location: {{ biz.city }}</p>
                <a href="{{ url_for('business.view_business', business_id=biz.id) }}" class="edit-btn">Manage</a>
              </div>
            {% endfor %}
          {% else %}
            <p>Nothing to see here yet...</p>
          {% endif %}
        </div>
      </section>

    </div>

  </main>

</body>
</html>