<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='view_bus.css') }}" />
</head>
<body>
  <nav class="navbar">
  <div class="nav-logo">
    Localate <img src="{{ url_for('static', filename='cat_logo.svg') }}" alt="Localate Logo" class="nav-icon">
  </div>
  <form method="GET" action="{{ url_for('search.search') }}" class="navbar-search-form" role="search" autocomplete="off" style="max-width: 600px; min-width: 300px; position: relative; overflow: visible;">
    <div class="search-input-wrapper" style="position: relative; width: 200%; margin-left: -30%;">
    <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"
         style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 1em; height: 1em; color: #888;">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1112 4.5a7.5 7.5 0 014.65 12.15z"/>
    </svg>
    <input
      type="search"
      id="navbar-q"
      name="q"
      placeholder="Search businesses"
      value="{{ request.args.get('q', '') }}"
      aria-label="Search businesses"
      class="search-input"
      style="width: 75%; padding: 0.5em 0.5em 0.5em 2.2em; border-radius: 25px; border: none; background-color: #1e1e1e; color: #eee; font-size: 1rem;"
    />
  </div>
  </form>
  <input type="checkbox" id="nav-toggle" class="nav-toggle">
  <ul class="nav-links">
    <li><a href="{{ url_for('business.index') }}"><img src="{{ url_for('static', filename='home_logo.svg') }}" alt="Home Icon" class="nav-icon-small"> Home</a></li>
      <li><a href="{{ url_for('business.dashboard') }}"><img src="{{ url_for('static', filename = 'dash_svg.svg') }}" alt ="Dash Icon" name="dash-icon" class="nav-icon-small"> Dashboard</a></li>
    <li><a href="{{ url_for('auth.logout') }}"><img src="{{ url_for('static', filename = 'logout.svg') }}" alt ="Logout Icon" name="logout-icon" class="nav-icon-small"> Logout</a></li>
  </ul>
  <label for="nav-toggle" class="nav-toggle-label">
    <span></span>
  </label>
</nav>


  <main class="view-business-container" style="position: relative;">
    <div class="profile-pic-upload" data-business-id="{{ business.id }}">
  <label for="profilePicInput" class="upload-circle">
    {% if business.profile_image_url %}
      <img id="profilePicPreview"
          src="{{ business.profile_image_url }}"
          alt="Profile Preview" />
      <span class="plus-icon" style="display: none;">+</span>
    {% else %}
      <span class="plus-icon">+</span>
    {% endif %}
  </label>
  <input type="file" id="profilePicInput" accept="image/*" style="display: none;" />
  <p class="upload-label">Add Profile Pic</p>
</div>

    <h1>{{ business.name }}</h1>
    <p class="category">{{ business.category }}</p>
    <p class="location">{{ business.city }}, {{ business.state }}</p>
    <p class="description">{{ business.description }}</p>

    <div class="business-details">
      <p><strong>Opening Time:</strong> {{ business.opening_time }}</p>
      <p><strong>Closing Time:</strong> {{ business.closing_time }}</p>
      <p><strong>Open Days:</strong> {{ business.open_days | join(', ') }}</p>
      <p><strong>Slot Interval:</strong> {{ business.interval }} minutes</p>
    </div>

    <div class="action-buttons">
      <a href="{{ url_for('business.edit_business', business_id=business.id) }}" class="btn">Edit Business</a>
      <a href="{{ url_for('business.view_appointments', business_id=business.id) }}" class="btn view-appts-btn">Manage Appointments</a>
      <a href="{{ url_for('business.dashboard') }}" class="btn secondary">Back to Dashboard</a>
    </div>
  </main>

<script>
  document.addEventListener('DOMContentLoaded', () => {
  const uploadDiv = document.querySelector('.profile-pic-upload');
  if (!uploadDiv) return;

  const businessId = uploadDiv.dataset.businessId;
  const fileInput = document.getElementById('profilePicInput');
  const previewImg = document.getElementById('profilePicPreview');
  const plusIcon = document.querySelector('.plus-icon');

  fileInput.addEventListener('change', function () {
    const file = this.files[0];
    if (!file) return;  

    const reader = new FileReader();
    reader.onload = function (e) {
      previewImg.src = e.target.result;
      previewImg.style.display = 'block';
      plusIcon.style.display = 'none';
    };
    reader.readAsDataURL(file);

    const formData = new FormData();
    formData.append('profile_pic', file);

    fetch(`/upload_profile_pic/${businessId}`, {
      method: 'POST',
      body: formData,
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          console.log("Upload successful:", data.url);
        } else {
          alert("Upload failed: " + data.error);
        }
      })
      .catch(err => {
        console.error("Upload error:", err);
        alert("Upload failed.");
      });
  });
});

</script>

</body>
</html>